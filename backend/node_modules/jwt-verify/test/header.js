var httpMocks = require('node-mocks-http');
var nock = require('nock');
var assert = require('assert');
var proxyquire = require('proxyquire');
var chai = require('chai');
var spies = require('chai-spies');
var jwt = require('../lib/jwt');

describe("header", function () {
	describe('extract', function () {

		beforeEach(function () {
			process.env.JWT_VERIFY_HOST = 'localhost';
			process.env.JWT_VERIFY_PORT = '90';
			nock('http://localhost:90').post('/jwt/verify').reply(200, {
				token: '1234567'
			});
			nock('http://localhost:90').post('/deposit/customer').reply(200, {
				status: 'ok'
			});
		})

		it('should get header value from the request', function (done) {
			var req = httpMocks.createRequest({
					method: 'GET',
					url: 'http://localhost:90/deposit/customer/',
					headers: {
						'Authorization': '1234567'
					}
				}),
				res = httpMocks.createResponse({
					req: req
				});
			jwt(req, res, function (err, result) {
				assert.equal(result, true);
				assert.equal(res.statusCode, 200)
				done();
			});
		});
	});

});
